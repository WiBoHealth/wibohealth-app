<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title data-i18n="calorie_tracker_title">Ù…ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© - WiBo Health</title>
    <meta name="description" content="Ù…ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ ØªØªØ¨Ø¹ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† ÙˆØ§Ù„ÙƒØ§Ø±Ø¨ ÙˆØ§Ù„Ø¯Ù‡ÙˆÙ† ÙˆØ§Ù„ÙÙŠØªØ§Ù…ÙŠÙ†Ø§ØªØŒ Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ©ØŒ ÙˆØªØ­Ù„ÙŠÙ„ ØºØ°Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„">
    <meta name="theme-color" content="#1a472a">
    
    <!-- hreflang Tags for SEO -->
    <link rel="alternate" hreflang="ar" href="https://wibohealth.com/calorie-tracker.html">
    <link rel="alternate" hreflang="en" href="https://wibohealth.com/en/calorie-tracker.html">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #1e1e1e;
            color: #e0e0e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header & Navigation */
        header {
            background: linear-gradient(135deg, #1a472a 0%, #2d7a4a 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        header .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .toggle-btn, .lang-btn {
            background-color: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .toggle-btn:hover, .lang-btn:hover {
            background-color: rgba(255,255,255,0.3);
        }

        body.dark-mode .toggle-btn, 
        body.dark-mode .lang-btn {
            background-color: rgba(0,0,0,0.3);
        }

        /* Main Content */
        .tracker-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }

        body.dark-mode .tracker-container {
            background-color: #2a2a2a;
            border: 1px solid #444;
        }

        .section-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1a472a;
            border-bottom: 2px solid #1a472a;
            padding-bottom: 10px;
        }

        body.dark-mode .section-title {
            color: #4da86a;
        }

        /* Input Form */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        body.dark-mode .form-group label {
            color: #e0e0e0;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background-color: #333;
            color: #e0e0e0;
            border-color: #555;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #1a472a;
            outline: none;
            box-shadow: 0 0 5px rgba(26, 71, 42, 0.3);
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, #1a472a 0%, #2d7a4a 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg, #2d5a3d 0%, #3d7a4a 100%);
        }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 700;
        }

        .stat-card .unit {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Progress Bars */
        .progress-container {
            margin-bottom: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }

        body.dark-mode .progress-bar {
            background-color: #444;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1a472a 0%, #2d7a4a 100%);
            transition: width 0.3s;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #1a472a;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2d7a4a;
            box-shadow: 0 4px 12px rgba(26, 71, 42, 0.3);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        body.dark-mode .btn-secondary {
            background-color: #333;
            color: #e0e0e0;
            border-color: #555;
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 30px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .tracker-container {
                padding: 20px;
            }

            .section-title {
                font-size: 18px;
            }

            .stat-card .value {
                font-size: 24px;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            header .nav-content {
                flex-direction: column;
                gap: 15px;
            }

            .nav-buttons {
                width: 100%;
                justify-content: center;
            }
        }

        /* Dark Mode Specific Styles */
        body.dark-mode {
            background-color: #1e1e1e;
        }

        body.dark-mode header {
            background: linear-gradient(135deg, #1a3a24 0%, #224d32 100%);
        }
    </style>
    <!-- Unified Language System -->
    <script src="js/unified-language-system.js"></script>
</head>

<body>
    <!-- Header & Navigation -->
    <header>
        <div class="nav-content">
            <a href="/" class="logo">ğŸ WiBo Health</a>
            <div class="nav-buttons">
                <button class="lang-btn" id="langToggle" data-i18n="change_language">Ø¹Ø±Ø¨ÙŠ</button>
                <button class="toggle-btn" id="darkModeToggle" data-i18n="dark_mode">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="tracker-container">
            <h1 class="section-title" data-i18n="calorie_tracker_title">Ù…ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©</h1>

            <!-- Daily Goal Input -->
            <div class="grid">
                <div class="form-group">
                    <label data-i18n="daily_calorie_goal">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø³Ø¹Ø±Ø§Øª:</label>
                    <input type="number" id="dailyGoal" min="1000" max="5000" value="2000" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ">
                </div>

                <div class="form-group">
                    <label data-i18n="protein_goal">Ù‡Ø¯Ù Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (ØºØ±Ø§Ù…):</label>
                    <input type="number" id="proteinGoal" min="10" max="300" value="150" placeholder="Ø£Ø¯Ø®Ù„ Ù‡Ø¯Ù Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†">
                </div>

                <div class="form-group">
                    <label data-i18n="carbs_goal">Ù‡Ø¯Ù Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (ØºØ±Ø§Ù…):</label>
                    <input type="number" id="carbsGoal" min="20" max="500" value="200" placeholder="Ø£Ø¯Ø®Ù„ Ù‡Ø¯Ù Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª">
                </div>

                <div class="form-group">
                    <label data-i18n="fat_goal">Ù‡Ø¯Ù Ø§Ù„Ø¯Ù‡ÙˆÙ† (ØºØ±Ø§Ù…):</label>
                    <input type="number" id="fatGoal" min="10" max="200" value="65" placeholder="Ø£Ø¯Ø®Ù„ Ù‡Ø¯Ù Ø§Ù„Ø¯Ù‡ÙˆÙ†">
                </div>
            </div>

            <!-- Add Food Item -->
            <div class="form-group">
                <label data-i18n="add_food_item">Ø£Ø¶Ù ÙˆØ¬Ø¨Ø©:</label>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <input type="text" id="foodName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…" style="flex: 1;">
                    <input type="number" id="foodCalories" min="0" placeholder="Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©" style="flex: 1;">
                    <input type="number" id="foodProtein" min="0" placeholder="Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (Øº)" style="flex: 1;">
                    <input type="number" id="foodCarbs" min="0" placeholder="Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (Øº)" style="flex: 1;">
                    <input type="number" id="foodFat" min="0" placeholder="Ø§Ù„Ø¯Ù‡ÙˆÙ† (Øº)" style="flex: 1;">
                    <button class="btn btn-primary" id="addFoodBtn" data-i18n="add_btn">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
            </div>

            <!-- Today's Intake -->
            <h2 class="section-title" data-i18n="today_intake">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙŠÙˆÙ…</h2>

            <!-- Summary Stats -->
            <div class="grid">
                <div class="stat-card">
                    <h3 data-i18n="total_calories">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø±Ø§Øª</h3>
                    <div class="value" id="totalCalories">0</div>
                    <div class="unit">kcal</div>
                </div>

                <div class="stat-card">
                    <h3 data-i18n="total_protein">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†</h3>
                    <div class="value" id="totalProtein">0</div>
                    <div class="unit">g</div>
                </div>

                <div class="stat-card">
                    <h3 data-i18n="total_carbs">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª</h3>
                    <div class="value" id="totalCarbs">0</div>
                    <div class="unit">g</div>
                </div>

                <div class="stat-card">
                    <h3 data-i18n="total_fat">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‡ÙˆÙ†</h3>
                    <div class="value" id="totalFat">0</div>
                    <div class="unit">g</div>
                </div>
            </div>

            <!-- Progress Section -->
            <h2 class="section-title" data-i18n="progress_title">Ø§Ù„ØªÙ‚Ø¯Ù…</h2>

            <div class="progress-container">
                <div class="progress-label">
                    <span data-i18n="calories">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©:</span>
                    <span><span id="caloriePercent">0</span>%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="calorieProgressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span data-i18n="protein">Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†:</span>
                    <span><span id="proteinPercent">0</span>%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="proteinProgressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span data-i18n="carbs">Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª:</span>
                    <span><span id="carbsPercent">0</span>%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="carbsProgressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-label">
                    <span data-i18n="fat">Ø§Ù„Ø¯Ù‡ÙˆÙ†:</span>
                    <span><span id="fatPercent">0</span>%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="fatProgressFill" style="width: 0%"></div>
                </div>
            </div>

            <!-- Food Log Table -->
            <h2 class="section-title" data-i18n="food_log">Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¹Ø§Ù…</h2>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #1a472a; color: white;">
                            <th style="padding: 12px; text-align: right;" data-i18n="food_name">Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…</th>
                            <th style="padding: 12px; text-align: center;" data-i18n="calories">Ø§Ù„Ø³Ø¹Ø±Ø§Øª</th>
                            <th style="padding: 12px; text-align: center;" data-i18n="protein">Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†</th>
                            <th style="padding: 12px; text-align: center;" data-i18n="carbs">Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª</th>
                            <th style="padding: 12px; text-align: center;" data-i18n="fat">Ø§Ù„Ø¯Ù‡ÙˆÙ†</th>
                            <th style="padding: 12px; text-align: center;" data-i18n="action">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="foodTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px; color: #999;" data-i18n="no_items">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Chart -->
            <h2 class="section-title" data-i18n="macro_breakdown">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØºØ°ÙŠØ§Øª</h2>
            <div class="chart-container">
                <canvas id="macroChart"></canvas>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" id="resetBtn" data-i18n="reset_btn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                <button class="btn btn-secondary" id="exportBtn" data-i18n="export_btn">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
        // Translation Dictionary
        const translations = {
            ar: {
                calorie_tracker_title: 'Ù…ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©',
                change_language: 'Ø¹Ø±Ø¨ÙŠ',
                dark_mode: 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ',
                daily_calorie_goal: 'Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„Ø³Ø¹Ø±Ø§Øª:',
                protein_goal: 'Ù‡Ø¯Ù Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (ØºØ±Ø§Ù…):',
                carbs_goal: 'Ù‡Ø¯Ù Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (ØºØ±Ø§Ù…):',
                fat_goal: 'Ù‡Ø¯Ù Ø§Ù„Ø¯Ù‡ÙˆÙ† (ØºØ±Ø§Ù…):',
                add_food_item: 'Ø£Ø¶Ù ÙˆØ¬Ø¨Ø©:',
                add_btn: 'Ø¥Ø¶Ø§ÙØ©',
                today_intake: 'Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙŠÙˆÙ…',
                total_calories: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¹Ø±Ø§Øª',
                total_protein: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†',
                total_carbs: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª',
                total_fat: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‡ÙˆÙ†',
                progress_title: 'Ø§Ù„ØªÙ‚Ø¯Ù…',
                calories: 'Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©',
                protein: 'Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†',
                carbs: 'Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª',
                fat: 'Ø§Ù„Ø¯Ù‡ÙˆÙ†',
                food_log: 'Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¹Ø§Ù…',
                food_name: 'Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…',
                action: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡',
                no_items: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±',
                macro_breakdown: 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØºØ°ÙŠØ§Øª',
                reset_btn: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†',
                export_btn: 'ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
                delete: 'Ø­Ø°Ù',
                protein_macro: 'Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†',
                carbs_macro: 'Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª',
                fat_macro: 'Ø§Ù„Ø¯Ù‡ÙˆÙ†'
            },
            en: {
                calorie_tracker_title: 'Calorie Tracker',
                change_language: 'English',
                dark_mode: 'Dark Mode',
                daily_calorie_goal: 'Daily Calorie Goal:',
                protein_goal: 'Protein Goal (grams):',
                carbs_goal: 'Carbs Goal (grams):',
                fat_goal: 'Fat Goal (grams):',
                add_food_item: 'Add Food Item:',
                add_btn: 'Add',
                today_intake: 'Today\'s Intake',
                total_calories: 'Total Calories',
                total_protein: 'Total Protein',
                total_carbs: 'Total Carbs',
                total_fat: 'Total Fat',
                progress_title: 'Progress',
                calories: 'Calories',
                protein: 'Protein',
                carbs: 'Carbs',
                fat: 'Fat',
                food_log: 'Food Log',
                food_name: 'Food Name',
                action: 'Action',
                no_items: 'No items',
                macro_breakdown: 'Macro Breakdown',
                reset_btn: 'Reset',
                export_btn: 'Export Data',
                delete: 'Delete',
                protein_macro: 'Protein',
                carbs_macro: 'Carbs',
                fat_macro: 'Fat'
            }
        };

        // Language Management
        let currentLanguage = localStorage.getItem('wibo_language') || 'ar';

        function t(key) {
            return translations[currentLanguage]?.[key] || translations['ar']?.[key] || key;
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('wibo_language', lang);
            updatePageLanguage();
        }

        function updatePageLanguage() {
            const isArabic = currentLanguage === 'ar';
            document.documentElement.lang = currentLanguage;
            document.documentElement.dir = isArabic ? 'rtl' : 'ltr';

            // Update all elements with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                    if (element.placeholder) {
                        element.placeholder = t(key);
                    }
                } else if (element.tagName === 'BUTTON' || element.tagName === 'LABEL' || element.tagName === 'TH' || element.tagName === 'TD') {
                    element.textContent = t(key);
                } else {
                    element.textContent = t(key);
                }
            });

            // Update lang button
            document.getElementById('langToggle').textContent = isArabic ? 'English' : 'Ø¹Ø±Ø¨ÙŠ';
            updateChart();
        }

        // Dark Mode Toggle
        function initializeDarkMode() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').textContent = currentLanguage === 'ar' ? 'â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­' : 'â˜€ï¸ Light Mode';
            }
        }

        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            document.getElementById('darkModeToggle').textContent = isDarkMode 
                ? (currentLanguage === 'ar' ? 'â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­' : 'â˜€ï¸ Light Mode')
                : (currentLanguage === 'ar' ? 'ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ' : 'ğŸŒ™ Dark Mode');
            updateChart();
        });

        // Language Toggle
        document.getElementById('langToggle').addEventListener('click', () => {
            const newLang = currentLanguage === 'ar' ? 'en' : 'ar';
            changeLanguage(newLang);
        });

        // Tracker Data
        let trackerData = JSON.parse(localStorage.getItem('trackerData')) || {
            foods: [],
            goals: {
                calories: 2000,
                protein: 150,
                carbs: 200,
                fat: 65
            }
        };

        // Update Goals
        document.getElementById('dailyGoal').value = trackerData.goals.calories;
        document.getElementById('proteinGoal').value = trackerData.goals.protein;
        document.getElementById('carbsGoal').value = trackerData.goals.carbs;
        document.getElementById('fatGoal').value = trackerData.goals.fat;

        function updateGoals() {
            trackerData.goals.calories = parseInt(document.getElementById('dailyGoal').value) || 2000;
            trackerData.goals.protein = parseInt(document.getElementById('proteinGoal').value) || 150;
            trackerData.goals.carbs = parseInt(document.getElementById('carbsGoal').value) || 200;
            trackerData.goals.fat = parseInt(document.getElementById('fatGoal').value) || 65;
            localStorage.setItem('trackerData', JSON.stringify(trackerData));
            updateDisplay();
        }

        ['dailyGoal', 'proteinGoal', 'carbsGoal', 'fatGoal'].forEach(id => {
            document.getElementById(id).addEventListener('change', updateGoals);
        });

        // Add Food
        document.getElementById('addFoodBtn').addEventListener('click', () => {
            const food = {
                id: Date.now(),
                name: document.getElementById('foodName').value,
                calories: parseFloat(document.getElementById('foodCalories').value) || 0,
                protein: parseFloat(document.getElementById('foodProtein').value) || 0,
                carbs: parseFloat(document.getElementById('foodCarbs').value) || 0,
                fat: parseFloat(document.getElementById('foodFat').value) || 0
            };

            if (food.name && (food.calories || food.protein || food.carbs || food.fat)) {
                trackerData.foods.push(food);
                localStorage.setItem('trackerData', JSON.stringify(trackerData));
                
                // Clear inputs
                document.getElementById('foodName').value = '';
                document.getElementById('foodCalories').value = '';
                document.getElementById('foodProtein').value = '';
                document.getElementById('foodCarbs').value = '';
                document.getElementById('foodFat').value = '';

                updateDisplay();
            } else {
                alert(currentLanguage === 'ar' ? 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù… ÙˆÙ‚ÙŠÙ…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„' : 'Please enter food name and at least one value');
            }
        });

        // Calculate Totals
        function calculateTotals() {
            return trackerData.foods.reduce((total, food) => ({
                calories: total.calories + food.calories,
                protein: total.protein + food.protein,
                carbs: total.carbs + food.carbs,
                fat: total.fat + food.fat
            }), { calories: 0, protein: 0, carbs: 0, fat: 0 });
        }

        // Update Display
        function updateDisplay() {
            const totals = calculateTotals();

            // Update Stats
            document.getElementById('totalCalories').textContent = totals.calories.toFixed(0);
            document.getElementById('totalProtein').textContent = totals.protein.toFixed(1);
            document.getElementById('totalCarbs').textContent = totals.carbs.toFixed(1);
            document.getElementById('totalFat').textContent = totals.fat.toFixed(1);

            // Update Progress
            const calPercent = Math.min(100, (totals.calories / trackerData.goals.calories) * 100);
            const protPercent = Math.min(100, (totals.protein / trackerData.goals.protein) * 100);
            const carbsPercent = Math.min(100, (totals.carbs / trackerData.goals.carbs) * 100);
            const fatPercent = Math.min(100, (totals.fat / trackerData.goals.fat) * 100);

            document.getElementById('calorieProgressFill').style.width = calPercent + '%';
            document.getElementById('proteinProgressFill').style.width = protPercent + '%';
            document.getElementById('carbsProgressFill').style.width = carbsPercent + '%';
            document.getElementById('fatProgressFill').style.width = fatPercent + '%';

            document.getElementById('caloriePercent').textContent = calPercent.toFixed(0);
            document.getElementById('proteinPercent').textContent = protPercent.toFixed(0);
            document.getElementById('carbsPercent').textContent = carbsPercent.toFixed(0);
            document.getElementById('fatPercent').textContent = fatPercent.toFixed(0);

            // Update Food Table
            const tableBody = document.getElementById('foodTableBody');
            if (trackerData.foods.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 20px; color: #999;">${t('no_items')}</td></tr>`;
            } else {
                tableBody.innerHTML = trackerData.foods.map(food => `
                    <tr style="border-bottom: 1px solid #ddd;">
                        <td style="padding: 12px; text-align: right;">${food.name}</td>
                        <td style="padding: 12px; text-align: center;">${food.calories.toFixed(0)}</td>
                        <td style="padding: 12px; text-align: center;">${food.protein.toFixed(1)}</td>
                        <td style="padding: 12px; text-align: center;">${food.carbs.toFixed(1)}</td>
                        <td style="padding: 12px; text-align: center;">${food.fat.toFixed(1)}</td>
                        <td style="padding: 12px; text-align: center;">
                            <button onclick="deleteFood(${food.id})" style="background-color: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 3px; cursor: pointer;">${t('delete')}</button>
                        </td>
                    </tr>
                `).join('');
            }

            updateChart();
        }

        // Delete Food
        function deleteFood(id) {
            trackerData.foods = trackerData.foods.filter(food => food.id !== id);
            localStorage.setItem('trackerData', JSON.stringify(trackerData));
            updateDisplay();
        }

        // Chart
        let macroChart = null;

        function updateChart() {
            const totals = calculateTotals();
            const isDarkMode = document.body.classList.contains('dark-mode');
            const textColor = isDarkMode ? '#e0e0e0' : '#333';

            const ctx = document.getElementById('macroChart').getContext('2d');

            if (macroChart) {
                macroChart.destroy();
            }

            macroChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [t('protein_macro'), t('carbs_macro'), t('fat_macro')],
                    datasets: [{
                        data: [totals.protein, totals.carbs, totals.fat],
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56'],
                        borderColor: isDarkMode ? '#2a2a2a' : '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: textColor,
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }

        // Reset
        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm(currentLanguage === 'ar' ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ' : 'Are you sure you want to delete all data?')) {
                trackerData.foods = [];
                localStorage.setItem('trackerData', JSON.stringify(trackerData));
                updateDisplay();
            }
        });

        // Export
        document.getElementById('exportBtn').addEventListener('click', () => {
            const data = {
                date: new Date().toLocaleDateString(),
                totals: calculateTotals(),
                goals: trackerData.goals,
                foods: trackerData.foods
            };

            const csv = 'Calorie Tracker Report\n' +
                `${t('calorie_tracker_title')}\n` +
                `Date: ${data.date}\n\n` +
                `${t('total_calories')}: ${data.totals.calories.toFixed(0)}\n` +
                `${t('total_protein')}: ${data.totals.protein.toFixed(1)}g\n` +
                `${t('total_carbs')}: ${data.totals.carbs.toFixed(1)}g\n` +
                `${t('total_fat')}: ${data.totals.fat.toFixed(1)}g\n\n` +
                `${t('food_name')}, ${t('calories')}, ${t('protein')}, ${t('carbs')}, ${t('fat')}\n` +
                data.foods.map(f => `${f.name}, ${f.calories}, ${f.protein}, ${f.carbs}, ${f.fat}`).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `calorie-tracker-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        });

        // Initialize
        initializeDarkMode();
        updatePageLanguage();
        updateDisplay();
    </script>
</body>

</html>
